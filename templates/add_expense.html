{% extends "base.html" %}

{% block title %}Add Expense - CouplesBudget Pro{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-plus"></i> Add New Expense</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    {{ form.hidden_tag() }}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.amount.label(class="form-label") }}
                            {{ form.amount(class="form-control", step="0.01", min="0") }}
                            {% if form.amount.errors %}
                                <div class="text-danger small">
                                    {% for error in form.amount.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.date.label(class="form-label") }}
                            {{ form.date(class="form-control") }}
                            {% if form.date.errors %}
                                <div class="text-danger small">
                                    {% for error in form.date.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.description.label(class="form-label") }}
                        {{ form.description(class="form-control", placeholder="e.g., Grocery shopping at Walmart") }}
                        {% if form.description.errors %}
                            <div class="text-danger small">
                                {% for error in form.description.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.category.label(class="form-label") }}
                            {{ form.category(class="form-select", onchange="updateSubcategories()") }}
                            {% if form.category.errors %}
                                <div class="text-danger small">
                                    {% for error in form.category.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.subcategory.label(class="form-label") }}
                            {{ form.subcategory(class="form-control", placeholder="Optional subcategory") }}
                            {% if form.subcategory.errors %}
                                <div class="text-danger small">
                                    {% for error in form.subcategory.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ form.priority.label(class="form-label") }}
                            {{ form.priority(class="form-select") }}
                            {% if form.priority.errors %}
                                <div class="text-danger small">
                                    {% for error in form.priority.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            {{ form.is_recurring.label(class="form-label") }}
                            {{ form.is_recurring(class="form-select", onchange="toggleFrequency()") }}
                            {% if form.is_recurring.errors %}
                                <div class="text-danger small">
                                    {% for error in form.is_recurring.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4 mb-3" id="frequencyDiv" style="display: none;">
                            {{ form.frequency.label(class="form-label") }}
                            {{ form.frequency(class="form-select") }}
                            {% if form.frequency.errors %}
                                <div class="text-danger small">
                                    {% for error in form.frequency.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.tags.label(class="form-label") }}
                        {{ form.tags(class="form-control", placeholder="e.g., work, personal, urgent") }}
                        {% if form.tags.errors %}
                            <div class="text-danger small">
                                {% for error in form.tags.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">Separate multiple tags with commas</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <a href="{{ url_for('expenses') }}" class="btn btn-secondary w-100">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                        </div>
                        <div class="col-md-6">
                            {{ form.submit(class="btn btn-primary w-100") }}
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Quick Tips Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Quick Tips</h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li><strong>Categories:</strong> Choose the most appropriate category for better tracking</li>
                    <li><strong>Recurring:</strong> Mark regular expenses like rent, utilities, or subscriptions</li>
                    <li><strong>Priority:</strong> Use high priority for essential expenses, low for discretionary</li>
                    <li><strong>Tags:</strong> Add custom tags for advanced filtering and analysis</li>
                </ul>
            </div>
        </div>
        
        <!-- Category Suggestions -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-list"></i> Category Examples</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Housing</h6>
                        <small class="text-muted">Rent, Mortgage, Property Tax, Maintenance</small>
                        
                        <h6 class="mt-3">Food</h6>
                        <small class="text-muted">Groceries, Restaurants, Takeout, Coffee</small>
                        
                        <h6 class="mt-3">Transportation</h6>
                        <small class="text-muted">Gas, Public Transport, Car Payment, Insurance</small>
                    </div>
                    <div class="col-md-6">
                        <h6>Entertainment</h6>
                        <small class="text-muted">Movies, Concerts, Streaming, Games</small>
                        
                        <h6 class="mt-3">Healthcare</h6>
                        <small class="text-muted">Insurance, Doctor, Pharmacy, Dental</small>
                        
                        <h6 class="mt-3">Shopping</h6>
                        <small class="text-muted">Clothing, Electronics, Household, Gifts</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleFrequency() {
    const recurring = document.querySelector('#is_recurring').value;
    const frequencyDiv = document.querySelector('#frequencyDiv');
    
    if (recurring === 'True') {
        frequencyDiv.style.display = 'block';
        document.querySelector('#frequency').required = true;
    } else {
        frequencyDiv.style.display = 'none';
        document.querySelector('#frequency').required = false;
    }
}

function updateSubcategories() {
    const category = document.querySelector('#category').value;
    const subcategoryInput = document.querySelector('#subcategory');
    
    // Category-specific subcategory suggestions
    const subcategories = {
        'housing': ['rent', 'mortgage', 'property_tax', 'maintenance', 'utilities'],
        'transportation': ['gas', 'public_transport', 'car_payment', 'insurance', 'maintenance'],
        'food': ['groceries', 'restaurants', 'takeout', 'coffee', 'alcohol'],
        'utilities': ['electricity', 'water', 'internet', 'phone', 'gas'],
        'healthcare': ['insurance', 'doctor', 'pharmacy', 'dental', 'vision'],
        'entertainment': ['movies', 'concerts', 'streaming', 'games', 'hobbies'],
        'shopping': ['clothing', 'electronics', 'household', 'gifts', 'books'],
        'education': ['tuition', 'books', 'courses', 'training', 'certification'],
        'insurance': ['health', 'auto', 'home', 'life', 'disability'],
        'debt': ['credit_card', 'student_loan', 'personal_loan', 'mortgage']
    };
    
    if (subcategories[category]) {
        subcategoryInput.placeholder = 'e.g., ' + subcategories[category].join(', ');
    } else {
        subcategoryInput.placeholder = 'Optional subcategory';
    }
}

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
    toggleFrequency();
    updateSubcategories();
});
</script>
{% endblock %}
